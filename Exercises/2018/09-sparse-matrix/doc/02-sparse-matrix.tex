\documentclass{beamer}
\usetheme{default}
\setbeamercovered{transparent}
\AtBeginSubsection[\inserttocsection]
{
  \begin{frame}<beamer>{Outline}
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}

\AtBeginSection[]
{
  \begin{frame}<beamer>{Outline}
    \tableofcontents[currentsection]
  \end{frame}
}

\usepackage[]{listings}
\lstset{language=C++,
basicstyle=\ttfamily,
keywordstyle=\color{blue}\ttfamily,
stringstyle=\color{red}\ttfamily,
commentstyle=\color{green}\ttfamily,
morecomment=[l][\color{magenta}]{\#}}

\begin{document}


\title{A Sparse Matrix Class Based on STL Containers}
\date{04.05.2018}

\begin{frame}
\maketitle
\end{frame}

\section{Sparse Matrices}

\begin{frame}
\frametitle{What is a Sparse Matrix}
\begin{itemize}
\item A (square) sparse matrix is a matrix whose number of non-zero elements $N_{nz}$ is $O(N)$, 
$N$ being the size of the matrix. \\[3mm]
\item The average number $m$ of non-zero elements per row (or column)
is constant w.r.t. the matrix size. \\[3mm]
\item If the majority of matrix entries is $0$,{\it i.e.} if $m \ll N$ it is convenient 
to store only the non-zero elements.\\[3mm]
\item The matrix-vector product (which is the basic ingredient of Krylov solvers) is $O(N)$ rather than $O(N^{2})$.\\[3mm]
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Some Examples of Sparse Matrix Formats}
Some (slightly revisited) classical data structures for sparse matrices

$$
A = 
\left[
\begin{array}{cccc}
4  & -1 & 0  & 0\\
-1 &  4 & -1 & 0\\
0  & -1 &  4 & -1\\
0  &  0 &  -1& 4
\end{array}
\right]
$$

\begin{itemize}
\item [COO] a.k.a AIJ :\\ \tiny
\begin{lstlisting}[language=C++]
std::vector<double> A {4.,-1.,-1.,4.,-1.,-1.,4.,-1.,-1.,4.};
std::vector<int>    I { 0,  0,  1, 1,  1,  2, 2,  2,  3, 3};
std::vector<int>    J { 0,  1,  0, 1,  2,  1, 2,  3,  2, 3};
\end{lstlisting} \normalsize
\item [triplet] :\\ \tiny
\begin{lstlisting}[language=C++]
std::vector<std::tuple<int, int, double>> 
{{0,0,4.},{0,1,-1.},{1,0,-1.},{1,1,4.},{1,2,-1.},{2,1,-1.},
{2,2,4},{2,3,-1.},{3,2,-1.},{3,3,4},{3,4,-1.},{4,3,-1.},{4,4,4.}};                                           
\end{lstlisting} \normalsize
\item [CSR] (Compressed Sparse Row) a.k.a. CRS or Yale\\ \tiny
\begin{lstlisting}[language=C++]
std::vector<double> V {4.,-1.,-1.,4.,-1.,-1.,4.,-1.,-1.,4.};
std::vector<int>    CI { 0,  1,  0, 1,  2,  1, 2,  3,  2, 3};
std::vector<int>    RP { 0,  2,  5, 8,  10};
\end{lstlisting} 
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Typical Operations With Sparse Matrices} 
\begin{itemize}
\item insertion \\
\lstinline|A[i][j] = x;|
\item deletion \\
\lstinline|A[i].erase (j);|
\item random access \\
\lstinline|x = A[i][j]; A[i][j] += y;|
\item sequential traversing \\
\small\begin{lstlisting}
for (row : A) {
  for (column : row)
  	std::cout << column << " ";
  std::cout << std::endl;
}
\end{lstlisting}\normalsize
\item Matrix $\times$ vector\\
\lstinline|std::vector<double> y = A * x;|
\end{itemize}
\end{frame}

\section{Sparse Matrices and STL Containers}

\begin{frame}[fragile]
\frametitle{Exercise : Use STL Containers to Build A Sparse Matrix Class}
\begin{itemize}
\item Implement a C++ class for sparse matrix based on STL containers
\item Simplify random access, allocation, entry increment, sequential traversal
\item Suggestion \small
\begin{lstlisting}[language=C++]
class 
sparse_matrix 
   : public std::vector<std::map<int,double>>
\end{lstlisting}\normalsize
\end{itemize}
\end{frame}



\begin{frame}[fragile]
\frametitle{Exercise : Sparse Matrix Class}
\tiny Implement the following methods :
\begin{itemize}

\item 
\tiny\begin{lstlisting}
/// Convert row-oriented sparse matrix to CRS format.
  void
  csr (std::vector<double> &a,
       std::vector<int> &col_ind,
       std::vector<int> &row_ptr);
\end{lstlisting} \normalsize

\item 
\tiny\begin{lstlisting}
/// Update the entries of a sparse matrix in CSR format.
  void
  csr_update (std::vector<double> &a,
              const std::vector<int> &col_ind,
              const std::vector<int> &row_ptr);
\end{lstlisting} \normalsize

\item 
\tiny\begin{lstlisting}
/// Output in Matlab language.
std::ostream & operator<< (std::ostream &stream,
                           sparse_matrix &sp)
\end{lstlisting} \normalsize

\item 
\tiny\begin{lstlisting}
  /// Sparse matrix increment. Automatically allocates additional entries.
  void 
  sparse_matrix::operator+= (sparse_matrix &adm)
\end{lstlisting} \normalsize

\item 
\tiny\begin{lstlisting}
  /// Sparse matrix increment. Automatically allocates additional entries.
  void 
  sparse_matrix::operator+= (sparse_matrix &adm)
\end{lstlisting} \normalsize

\item 
\tiny\begin{lstlisting}
  /// Compute matrix-vector product.
  friend std::vector<double>
  operator * (sparse_matrix& M, const std::vector<double>& x);
\end{lstlisting} \normalsize

\end{itemize}
\end{frame}

\end{document}